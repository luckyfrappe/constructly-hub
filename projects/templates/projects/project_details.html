{% extends "base.html" %}
{% load static %}
{% block content %}
<main class="mx-auto max-w-7xl w-full px-4 sm:px-6 lg:px-8 overflow-x-hidden">
    <div class="my-4 card flex flex-col p-6">
        <a href="javascript:history.back()" class="my-button mb-4 w-22">Back</a>
        <!-- Project Header -->
        <div class="flex flex-col lg:items-center lg:justify-between mb-10 border-b pb-8">
            <div class="flex flex-col md:flex-row md:items-center w-full justify-between gap-6">
                <div>
                    <h1 class="text-5xl mb-2">{{ project.title }}</h1>
                    <p class=" text-lg mb-1">
                        <i class="fas fa-map-marker-alt "></i>
                        {{ project.location }}
                    </p>
                    <div class="relative mt-8 flex items-center gap-x-4">
                        {% if project.client.userprofile.avatar.public_id == "default_avatar" or not project.client.userprofile.avatar %}
                        <img src="{% static 'images/profile.png' %}" alt=""
                            class="size-10 rounded-full bg-gray-700" />
                        {% else %}
                        <img src="{{ project.client.userprofile.avatar.url }}" alt="" class="size-10 rounded-full object-cover" />
                        {% endif %}
                        <div class="text-sm/6">
                            <p class=""><i class="fas fa-user"></i> {% if project.client.userprofile.full_name %}{{ project.client.userprofile.full_name }}{% else %}{{ project.client.username }}{% endif %}</p>
                            </p>
                            {% if project.client.userprofile.display_email %} <p><i class="fas fa-envelope"></i> {{ project.client.userprofile.display_email }}</p>{% endif %}
                        </div>
                    </div>
                </div>

                <div>
                    <div
                        class="mt-6 flex flex-col gap-4 sm:flex-row sm:gap-6 lg:mt-0">
                        <div class="flex flex-col items-start">
                            <p class="text-sm/6">Budget</p>
                            <p class="text-lg font-bold"><i class="fas fa-euro-sign"></i> {{ project.budget }}</p>
                        </div>
                        <div class="flex flex-col items-start">
                            <p class="text-sm/6">Deadline</p>
                            <p class="text-lg font-bold">{{ project.deadline }}</p>
                        </div>
                        <div class="flex flex-col items-start">
                            <p class="text-sm/6">Status</p>
                            <p class="text-lg font-bold">{% if project.status == "open" %}<i class="fas fa-lock-open"></i>{% else %}<i class="fas fa-lock"></i>{% endif %} {{ project.status }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <h2 class="text-2xl mb-4"><i class="fas fa-info-circle"></i> Project Description</h2>
        <div class="mb-10 card">
            <p class="text-base/7 whitespace-pre-line">{{ project.description }}</p>
        </div>

        {% if project.client == user %}
        <h2 class="text-2xl mb-4">
                <i class="fas fa-gavel"></i> Bids Received
        </h2>
        <div class="mb-10 card">
            <!-- single bid card -->
            <div class="bid-card p-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">

                <!-- left side -->
                <div class="flex-1">
                    <p><i class="fas fa-info-circle"></i> Bid 1</p>
                    <p class="text-base/7 whitespace-pre-line">{{ project.description }}</p>
                </div>

                <!-- right side buttons -->
                <div class="flex gap-2 w-full sm:w-auto justify-start sm:justify-end">
                    <a href="" class="normal-button sm:w-auto text-center">View Company</a>
                    <a href="" class="normal-button sm:w-auto text-center">Select Bid</a>
                </div>
            </div>
        </div>
        {% endif %}

        {% if project.client != user and project.status == "open" %}
    <h2 class="text-2xl mb-4">
        <i class="fas fa-gavel"></i> Place Your Bid
    </h2>

    <div class="mb-10 card p-4">

        <!-- Bid form -->
        <form method="POST" class="flex flex-col gap-4">
            {% csrf_token %}

            <!-- price -->
            <div>
                <label for="price" class="block font-medium">Your Offer (â‚¬)</label>
                <input
                    id="price"
                    type="number"
                    name="price"
                    class="mt-1 w-full rounded-md py-1.5 px-3 bg-transparent border"
                    placeholder="e.g. 25000"
                    required
                >
            </div>

            <!-- message -->
            <div>
                <label for="message" class="block font-medium">Message (Optional)</label>
                <textarea
                    id="message"
                    name="message"
                    rows="3"
                    class="mt-1 w-full rounded-md py-1.5 px-3 bg-transparent border"
                    placeholder="Describe your offer..."
                ></textarea>
            </div>

            <!-- submit -->
            <button type="submit" class="my-button w-full sm:w-auto">
                Submit Bid
            </button>
        </form>

    </div>
{% endif %}
    </div>
</main>
{% endblock content %}